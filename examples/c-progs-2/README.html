<h1>C Program Examples#2</h1>
<p>These are some C program examples from my course on systems 
programming (<a href="https://down.dsg.cs.tcd.ie/cs2014">CS2014</a>),
the canonical URL for this is 
<a href="https://down.dsg.cs.tcd.ie/cs2014/examples/c-progs-2/README.html">here</a>.</p>
<h2>Files in this example:</h2>
<ul>
<li>README.md - this file in markdown format</li>
<li>README.html - this file, in HTML format (<code>'make html'</code> to update that from .md)</li>
<li><a href="Makefile">Makefile</a> - to build the example and HTML (there's a clean target too)</li>
<li><a href="rndbytes.c">rndbytes.c</a> - a couple of wee utility fuctions to get stuff from <code>/dev/random</code></li>
<li><a href="rndbytes.h">rndbytes.h</a> - header for those functions</li>
<li><a href="rbtest.c">rbtest.c</a> - <code>main()</code> that calls functions from <code>rndbytes.h</code></li>
</ul>
<p>After running <code>'make'</code> then these files will be produced (if all
goes well):</p>
<ul>
<li>README.html - the html version of README.md</li>
<li>rndbytes.o - the rndbytes object file</li>
<li>rbtest - the rndbytes test program</li>
</ul>
<h2>A More Structured <code>rndbytes.c</code> setup</h2>
<p>This iteration of the <code>rndbytes</code> example demonstrates a bunch of 
things that we'll talk about in class:</p>
<ul>
<li>Making a header file</li>
<li>Object files</li>
<li>Documentation (via doxygen, not sure how relevant, but leads to useful thoughts)</li>
<li>Coding styles such as <a href="https://developer.mozilla.org/en-US/docs/Mozilla/Developer_guide/Coding_Style">Mozilla's</a></li>
<li>Performance (running <code>time c-prog-2/rbtest 60000</code> vs. <code>time c-prog-1/rndbytes 60000</code>) </li>
</ul>
<h2>Header file</h2>
<p>Here's the source:</p>
<pre><code>    /*!
     * @file rndbytes.h
     * @brief This is the external i/f for the rndbytes example
     * 
     * This is part of CS2014
     *    https://down.dsg.cs.tcd.ie/cs2014/examples/c-progs-2/README.html
     */

    /* 
     * Copyright (c) 2017 stephen.farrell@cs.tcd.ie
     * 
     * Permission is hereby granted, free of charge, to any person obtaining a copy
     * of this software and associated documentation files (the "Software"), to deal
     * in the Software without restriction, including without limitation the rights
     * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
     * copies of the Software, and to permit persons to whom the Software is
     * furnished to do so, subject to the following conditions:
     * 
     * The above copyright notice and this permission notice shall be included in
     * all copies or substantial portions of the Software.
     * 
     * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
     * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
     * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
     * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
     * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
     * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
     * THE SOFTWARE.
     *
     */

    /*!
     * @brief produce a random byte
     * @return the random byte
     *
     * Get me a random byte from /dev/random 
     *
     */
    unsigned char rndbyte();

    /*!
     * @brief fill a buffer with random bytes
     * @param buf an allocated buffer of at least the required size 
     * @param buflen the number of random bytes to insert into the buffer
     * @return zero for success, nonzero for error
     *
     * Fill me buffer with randoms.
     *
     */
    int rndbytes(unsigned char* buf,int buflen);
</code></pre>
<p>Noteworthy:
- doxygen header @ top and before function prototypes
- function prototypes, one we've seen and one we've not 
- memory management of <code>buf</code> parameter of <code>rndbytes</code></p>
<h2>The Makefile</h2>
<p>The significant part of the Makefile is below...</p>
<pre><code>    all: html rbtest

    rbtest: rbtest.c rndbytes.o rndbytes.h

    rndbytes.o: rndbytes.c rndbytes.h

    doc: rbtest rnd-dox latex/refman.pdf
        doxygen rnd-dox

    latex/refman.pdf:
        cd latex;make

    rnd-dox:
        doxygen -g rnd-dox

    html: README.html

    clean:
        @rm -f rbtest rndbytes.o 
        @rm -rf latex html

    reallyclean: clean
        @rm -f README.html rnd-dox

    %.html: %.md
        $(MDCMD) $(MDOPTS) $(@) $(&lt;)
</code></pre>